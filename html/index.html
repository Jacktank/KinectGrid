<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>KinectGrid Settings</title>
<style>
	body {
			background-color:#DDD;
	}
	#settingKinectForm { }
	#settingKinectForm * span.propName { margin-right:1em; width:13em; text-align:right;color:blue;display:inline-block;}
	#settingKinectForm input { text-align:center;}
	#settingKinectForm input[type="button"] { width:2.5em; }

	.containerL {float:left; max-width:44em; }
	.containerR {float:right; max-width:44em; }
	div#desc_calibration ol > li { margin-bottom:1em; }
	div#desc_calibration ol * ol { list-style-type:lower-roman; }
</style>
<!--<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>-->
<script type="text/javascript" src="jquery_1.7.1_jquery.min.js"></script>
<script type="text/javascript" src="jquery.dform-0.2.0.min.js"></script>
<script type="text/javascript" src="json2.min.js"></script>
<script type="text/javascript" src="kinectgrid_settings.js"></script>
<script type="text/javascript" src="kinectgrid_script.js"></script>
</head>
<body>
	<div class="containerL">
		<h1>Configs</h1>
		<div id="configs">
			<input type="button" value="Load Config" onclick="loadConfig()"/>
			<input id="configFilename" type="text" size="10" value="{{LAST_SETTING_FILENAME}}" />
			<input type="button" value="Save Config" onclick="saveConfig()"/>
		</div>	
		<div>
			<p>
			<input type="button" value="Start Area Detection" onclick="areaDetection(1)"/>
			<input type="button" value="Stop Area Detection" onclick="areaDetection(0)"/>
			</p>
			<p>
			<input type="button" value="Refit" onclick="repoke()" title="Try to find areas on previous saved positions" />
			</p>
		</div>
		<h1>View</h1>
		<input type="button" onclick="setView(1)" value="Raw depth image" />
		<input type="button" onclick="setView(2)" value="Depth mask" />
		<input type="button" onclick="setView(3)" value="Hand,Blob view" />
		<input type="button" onclick="setView(4)" value="Areas" />
		<input type="button" onclick="setView(5)" value="Frame" />
		<input type="button" onclick="setView(6)" value="No image refresh (saves cpu time)" />
		<h1>Load/Save Masks</h1>
		<input type="button" onclick="loadMasks()" value="Load masks" />
		<input type="button" onclick="saveMasks()" value="Save masks" />
		<p>Frameless mode: If your frame is not present you can load former depth and area mask.</p>
		<p>Filename pattern: {Configname}_[depth|area].png</p>
		<h1>End program</h1>
		<input type="button" onclick="quit()" value="Quit" />
	</div>
	<div class="containerL">
		<h1>Variables<a style="font-size:70%;float:right;" href="javascript:resetConfig();">(Reset values)</a></h1>
		<div id="settingKinectForm"> </div>
	</div>
	<div class="containerL" id="desc_calibration">
		<h1>Calibration</h1>
		Note that the raw depth values (0-2048) will be flipped: 255=close points, 0=distant points.
		<ol>
			<li>Set Depth Range
			<ol>
				<li>Select raw depth view (press '1')</li>
				<li>Raise <i>minDepth</i> till first obstacles are light grey.</li>
				<li>Lower <i>maxDepth</i> till background is nearly black.</li>
			</ol>
			</li>
			<li>Use <i>margin[Left|Top|Right|Bottom]</i> to crop image.
			</li>
			<li>Select front mask image
			<ol>
				<li>Select front mask view (press '5')</li>
				<li>Raise <i>marginFront</i> till the frame is white and all other parts still black.</li>
			</ol>
			This black/white-image will used to find the 'holes' of your frame. Ensure that the areas are full enclosed.
			</li>
			<li>Use <i>marginBack</i> to set the minimal background threshold (depth mask) for blob detection.<br> Press '2' to show the depth mask. This global threshold will increased pixelwise in two cases:
			<ol>
				<li>During the depth mask creation on startup (and configuration changes) by all obstacles.
				(Roughly <i>depthMask = max(sensordata, 255-marginBack)</i>). Thus, do not block the camera during initialisation. 				
				</li>
				<li>If the option <i>areaThresh</i> is enabled, the depth mask inside an area depends by its border pixel distances.</li>
			</ol>
			</li>
			<li>Save Configuration</li>
		</ol>
	</div>
	<div class="containerL">
		<h1>Area Detection</h1>
		If the calibration was finished (<i>mask view</i> looks feasible and <i>blob view</i> do not react on tiny, undesired disturbances) you can start the area detection.<br>
		Click on <i>Start Area Detection</i>, place behind the frame, and push a hand in the first area. Select more areas and finish area detection with an second push into area 1.
		<h1>Refit</h1>
		Use this option to repeat the area detection. It search areas nearby the saved midpoints.
		<h1>Load/Save Masks</h1>
		If you want remove the frame after the setup you can click on <i>Save mask</i>. This creates two images ({Configname}_[depth|area].png), which will be loaded at startup and reconstruct the previous depth filter and area definition. Remove this files to restore the normal startup behaviour.
	</div>
	<div class="containerL">
		<h1>Variables Description</h1>
		minBlobArea, maxBlobArea: Filter small and tall blobs out.<br>
		TUIO_2Dcur : Send tuio messages in 2Dcur format<br>
		TUIO_25Dblb : Send tuio messages in 25Dblb format (like Space Palette).<br>
		areaThresh : Use depth of the frame to filter hand movement behind the frame.<br>
		directFiltering: Skip depthFrame evaluation to avoid some memcpy. (For ARM, Slower on x86.)<br>
	</div>
	<hr style="clear:both;margin-top:3em;" />
	<div class="containerL" >
		<img src="sketchFront.png" style="max-width:100%"/>
	</div>
	<div class="containerR" >
		<img src="sketchSide.png" style="max-width:100%"/>
	</div>
</body>
